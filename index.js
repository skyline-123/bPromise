!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bPromise=t()}(this,function(){"use strict";function s(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function o(){return"undefined"!=typeof window&&"undefined"!=typeof MutationObserver}function f(e){if(o()){var t=new MutationObserver(function(){"function"===s(e)&&(t.disconnect(),e())});t.observe(this.element,{attributes:!0}),this.element.setAttribute("class","")}else"undefined"==typeof window&&"undefined"!=typeof process?process.nextTick(e):setTimeout(e)}function a(e){var n=this;function t(t){f(function(){"pending"===n.PromiseStatus&&(n.PromiseStatus="rejected",n.PromiseValue=t,n.onRejectedCallbacks.forEach(function(e){e(t)}))})}this.PromiseStatus="pending",this.PromiseValue,this.onResolvedCallbacks=[],this.onRejectedCallbacks=[],this.element,o()&&(this.element=document.createElement("span"));try{e(function(t){f(function(){"pending"===n.PromiseStatus&&(n.PromiseStatus="fulfilled",n.PromiseValue=t,n.onResolvedCallbacks.forEach(function(e){e(t)}))})},t)}catch(e){t(e)}}function l(t,e,n,o){if(t===e)o(new TypeError(e));else if(e instanceof a)"pending"===e.PromiseStatus?e.then(function(e){l(t,e,n,o)},o):e.then(n,o);else if("object"===s(e)||"function"===s(e)){var i,c=!1;try{"function"===s(i=e.then)?i.call(e,function(e){c||(c=!0,l(t,e,n,o))},function(e){c||(c=!0,o(e))}):n(e)}catch(e){c||(c=!0,o(e))}}else n(e)}return a.prototype.then=function(i,c){var r,u=this;return i="function"===s(i)?i:function(e){return e},c="function"===s(c)?c:function(e){throw e},"fulfilled"===this.PromiseStatus&&(r=new a(function(t,n){f(function(){try{var e=i(u.PromiseValue);l(r,e,t,n)}catch(e){n(e)}})})),"rejected"===this.PromiseStatus&&(r=new a(function(t,n){f(function(){try{var e=c(u.PromiseValue);l(r,e,t,n)}catch(e){n(e)}})})),"pending"===this.PromiseStatus&&(r=new a(function(n,o){u.onResolvedCallbacks.push(function(e){try{var t=i(e);l(r,t,n,o)}catch(e){o(e)}}),u.onRejectedCallbacks.push(function(e){try{var t=c(e);l(r,t,n,o)}catch(e){o(e)}})})),r},a.prototype.catch=function(e){return this.then(void 0,e)},a.deferred=function(){var n={};return n.promise=new a(function(e,t){n.resolve=e,n.reject=t}),n},a.resolve=function(n){return new a(function(e,t){e(n)})},a.reject=function(n){return new a(function(e,t){t(n)})},a});
