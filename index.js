!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.bPromise=t()}(this,function(){"use strict";function u(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function a(e){var n=this;function t(t){n.handleCallback(function(){"pending"===n.PromiseStatus&&(n.PromiseStatus="rejected",n.PromiseValue=t,n.onRejectedCallbacks.forEach(function(e){e(t)}))})}this.PromiseStatus="pending",this.PromiseValue,this.onResolvedCallbacks=[],this.onRejectedCallbacks=[],this.element,this.isSupportMutationObserver="undefined"!=typeof window&&"undefined"!=typeof MutationObserver,this.isSupportMutationObserver&&(this.element=document.createElement("span")),this.handleCallback=function(e){if(this.isSupportMutationObserver){var t=new MutationObserver(function(){"function"===u(e)&&(e(),t.disconnect())});t.observe(this.element,{attributes:!0}),this.element.setAttribute("class","")}else"undefined"==typeof window&&"undefined"!=typeof process?process.nextTick(e):setTimeout(e)};try{e(function(t){n.handleCallback(function(){"pending"===n.PromiseStatus&&(n.PromiseStatus="fulfilled",n.PromiseValue=t,n.onResolvedCallbacks.forEach(function(e){e(t)}))})},t)}catch(e){t(e)}}var f=function(t,e,n,i){if(t===e)i(new TypeError(e));else if(e instanceof a)"pending"===e.PromiseStatus?e.then(function(e){f(t,e,n,i)},i):e.then(n,i);else if("object"===u(e)||"function"===u(e)){var o,c=!1;try{"function"===u(o=e.then)?o.call(e,function(e){c||(c=!0,f(t,e,n,i))},function(e){c||(c=!0,i(e))}):n(e)}catch(e){c||(c=!0,i(e))}}else n(e)};return a.prototype.then=function(o,c){var r,s=this;return o="function"===u(o)?o:function(e){return e},c="function"===u(c)?c:function(e){throw e},"fulfilled"===this.PromiseStatus&&(r=new a(function(t,n){s.handleCallback(function(){try{var e=o(s.PromiseValue);f(r,e,t,n)}catch(e){n(e)}})})),"rejected"===this.PromiseStatus&&(r=new a(function(t,n){s.handleCallback(function(){try{var e=c(s.PromiseValue);f(r,e,t,n)}catch(e){n(e)}})})),"pending"===this.PromiseStatus&&(r=new a(function(n,i){s.onResolvedCallbacks.push(function(e){try{var t=o(e);f(r,t,n,i)}catch(e){i(e)}}),s.onRejectedCallbacks.push(function(e){try{var t=c(e);f(r,t,n,i)}catch(e){i(e)}})})),r},a.prototype.catch=function(e){return this.then(void 0,e)},a.deferred=function(){var n={};return n.promise=new a(function(e,t){n.resolve=e,n.reject=t}),n},a.resolve=function(n){return new a(function(e,t){e(n)})},a.reject=function(n){return new a(function(e,t){t(n)})},a});
